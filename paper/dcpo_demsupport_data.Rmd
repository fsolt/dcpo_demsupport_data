---
output: 
  bookdown::pdf_document2:
    fig_caption: yes
    keep_tex: yes
    toc: no
    number_sections: no
    latex_engine: xelatex
    pandoc_args: --lua-filter=multibib.lua
  
title: |
  | Support for Democracy Is Multidimensional: 
  | Why Unidimensional Latent Variable Measures of
  | Democratic Support Are Invalid
  
# keywords: "Democratization, public support, regime survival, measurement uncertainty, latent variables."

date: " "
editor_options: 
  markdown: 
    wrap: sentence
tables: true # enable longtable and booktabs
citation_package: natbib
citeproc: false
fontsize: 12pt
indent: true
linestretch: 1.5 # double spacing using linestretch 1.5
bibliography:
  text: dcpo-demsupport-data.bib
  app: dcpo-demsupport-data-app.bib
biblio-style: apsr
citecolor: black
linkcolor: black
endnote: no
header-includes:
      - \usepackage{array}
      - \usepackage{caption}
      - \usepackage{graphicx}
      - \usepackage{siunitx}
      - \usepackage{colortbl}
      - \usepackage{multirow}
      - \usepackage{hhline}
      - \usepackage{calc}
      - \usepackage{tabularx}
      - \usepackage{threeparttable}
      - \usepackage{wrapfig}
      - \usepackage{fullpage}
      - \usepackage{lscape} #\usepackage{lscape} better for printing, page displayed vertically, content in landscape mode, \usepackage{pdflscape} better for screen, page displayed horizontally, content in landscape mode
      - \newcommand{\blandscape}{\begin{landscape}}
      - \newcommand{\elandscape}{\end{landscape}}
      - \usepackage{titlesec}
      - \titleformat*{\section}{\normalsize\bfseries}
      - \titleformat*{\subsection}{\normalsize\itshape}
      - \usepackage{titling} #use \maketitle repeatedly
---

\pagenumbering{gobble}

# Authors {.unnumbered}

-   Yue Hu, ORCID: <https://orcid.org/0000-0002-2829-3971>, Associate Professor, Department of Political Science, Tsinghua University, [yuehu\@tsinghua.edu.cn](mailto:yuehu@tsinghua.edu.cn){.email}
-   Yuehong Cassandra Tai, ORCID: <https://orcid.org/0000-0001-7303-7443>, Postdoctoral Fellow, Center for Social Data Analytics, Pennsylvania State University, [yhcasstai\@psu.edu](mailto:yhcasstai@psu.edu){.email}
-   Hyein Ko, ORCID: <https://orcid.org/0000-0002-9497-9656>, Doctoral Candidate, Department of Political Science, University of Iowa, [hyein-ko\@uiowa.edu](mailto:hyein-ko@uiowa.edu){.email}
-   Byung-Deuk Woo, ORCID: <https://orcid.org/0000-0001-6902-7576>, Postdoctoral Researcher, Institute of Social Data Science, Pohang University of Science and Technology, [byungdeukwoo\@gmail.com](mailto:byungdeukwoo@gmail.com){.email}
-   Frederick Solt, corresponding author, ORCID: <https://orcid.org/0000-0002-3154-6132>, Associate Professor, Department of Political Science, University of Iowa, [frederick-solt\@uiowa.edu](mailto:frederick-solt@uiowa.edu){.email}

\pagebreak

```{=tex}
\renewcommand{\baselinestretch}{1}
\selectfont
\maketitle
\renewcommand{\baselinestretch}{1.5}
\selectfont
```

```{=tex}
\begin{abstract}
Measuring democratic support as a single latent variable requires assuming that it falls along a single dimension from steadfast opposition to wholehearted support.
This ignores ample evidence that support for democracy is complex and multidimensional.
Here we provide a series of validation tests of the sort of cross-national time-series latent variable measures employed in recent research by reference to questions on support for liberal democracy and opposition to its erosion from multiwave surveys conducted around the world.
These tests show that, across countries and years, this latent variable is nearly orthogonal to measures of support for contestation and participation; civil liberties; institutional constraints on executive power; and prioritizing democracy over the economy, economic equality, or order.
We conclude that support for democracy in any robust sense is simply not well captured by a unidimensional latent variable.
Such measures are powerful but researchers must be mindful of their limitations.
\end{abstract}
```
\pagebreak

\pagenumbering{arabic}

```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  cache = TRUE,
  dpi = 600,
  fig.width=7,
  fig.height = 2.5,
  plot = function(x, options)  {
    hook_plot_tex(x, options)
  }
)

# If `DCPOtools` is not yet installed:
# remotes::install_github("fsolt/DCPOtools")

if (!require(pacman)) install.packages("pacman")
library(pacman)
# load all the packages you will use below 
p_load(
  DCPOtools,
  cmdstanr,
  tidyverse,
  here,
  countrycode,
  patchwork,
  ggthemes,
  rsdmx,
  osfr,
  kableExtra
) 

# define functions
validation_plot <- function(v_data_raw,
                            lab_x = .38, lab_y = 92,
                            theta_summary, theta_results) {
    
    # defaults per https://stackoverflow.com/a/49167744/2620381
    if ("theta_summary" %in% ls(envir = .GlobalEnv) & missing(theta_summary))
        theta_summary <- get("theta_summary", envir = .GlobalEnv)
    if ("theta_results" %in% ls(envir = .GlobalEnv) & missing(theta_results))
        theta_results <- get("theta_results", envir = .GlobalEnv)

    median_val <- Vectorize(function(x) median(1:x),
                            vectorize.args = "x")
    
    v_vars <- v_data_raw %>% 
      select(item0 = item) %>% 
      unique() %>% 
      mutate(v_val = str_extract(item0, "\\d+") %>% 
               as.numeric() %>% 
               {median_val(.) + 1} %>%
               floor())
    
    # v_val <- str_extract(v_vars, "\\d+") %>% 
    #   as.numeric() %>%
    #   median(x = 1:.) %>% 
    #   `+`(1) %>% 
    #   floor()

    # v_vals <- v_vars %>% 
    #   mutate(value = str_extract("\\d+") %>% 
    #            as.numeric(),
    #          v_var2 = {median_val(value) + 1} %>% floor())
    
    validation_summarized <- v_data_raw %>% 
      DCPOtools::format_dcpo(scale_q = v_vars$item0[[1]], # these arguments are required
                             scale_cp = 1) %>% # but they don't matter
      pluck("data") %>% 
      mutate(item0 = str_remove(item, " \\d or higher"),
             title = factor(title, 
                            levels = v_data_raw %>%
                              pull(title) %>%
                              unique())) %>% 
      right_join(v_vars, by = "item0") %>%
      arrange(title) %>% 
      filter(str_detect(item, paste(v_val, "or higher"))) %>%
      mutate(iso2c = countrycode::countrycode(country,
                                              origin = "country.name",
                                              destination = "iso2c"),
             prop = if_else(neg, 1-y_r/n_r, y_r/n_r),
             se = sqrt((prop*(1-prop))/n),
             prop_90 = prop + qnorm(.9)*se,
             prop_10 = prop - qnorm(.9)*se) %>%
      inner_join(theta_summary %>% select(-kk, -tt), by = c("country", "year"))
    
    # if ("title" %in% names(v_data_raw)) {
    #   v_title <- v_data_raw %>% 
    #     filter(item == v_var) %>% 
    #     pull(title) %>% 
    #     first()
    # } else {
    #   v_title <- v_var
    # } 
    
    validation_cor <- theta_results %>%
      inner_join(validation_summarized %>%
                   select(country, year, title, prop, se),
                 by = c("country", "year")) %>% 
      rowwise() %>% 
      mutate(sim = rnorm(1, mean = prop, sd = se)) %>% 
      ungroup() %>% 
      select(title, theta, sim, draw) %>% 
      nest(data = c(theta, sim)) %>% 
      mutate(r = lapply(data, function(df) cor(df) %>% nth(2)) %>% 
               unlist()) %>%
      select(-data) %>% 
      group_by(title) %>% 
      summarize(r = paste("R =", round(mean(r), 2)))

   
    validation_summarized %>%
      ggplot(aes(x = mean,
                 y = prop * 100)) +
      geom_segment(aes(x = q10, xend = q90,
                       y = prop * 100, yend = prop * 100),
                   na.rm = TRUE,
                   alpha = .2) +
      geom_segment(aes(x = mean, xend = mean,
                       y = prop_90 * 100, yend = prop_10 * 100),
                   na.rm = TRUE,
                   alpha = .2) +
      geom_smooth(method = 'lm', formula = 'y ~ x', se = FALSE) +
      facet_wrap(~ title, ncol = 4) +
      geom_label(data = validation_cor, aes(x = lab_x,
                                            y = lab_y,
                                            label = r),
                 size = 2)
}

set.seed(324)
```

```{r dcpo_input_raw, include=FALSE, cache.extra = tools::md5sum(here::here("data-raw", "surveys_demsupport.csv"))}
survey_file <- list.files(here("data-raw"),
                          full.names = TRUE) %>% 
  str_subset("surveys.*\\.csv")

surveys <- read_csv(survey_file,
                    col_types = "ccccccc")

dcpo_input_raw <- DCPOtools::dcpo_setup(vars = surveys,
                                        datapath = here("..",
                                                        "data",
                                                        "dcpo_surveys"),
                                        file = here("data",
                                                    "dcpo_input_raw.csv"))
```

```{r summary_stats, cache = TRUE, cache.extra = tools::md5sum(here::here("data-raw", "dcpo_input_raw.csv"))}
dcpo_input_raw <- read_csv(here("data", "dcpo_input_raw.csv"),
                                  col_types = "cdcddcd")

with_min_coverage <- function(x, min_cov) {
  if (!is.na(min_cov)) {
    country <- year <- years <- spanned <- coverage <- NULL

    x <- x %>%
      group_by(country) %>%
      mutate(years = length(unique(year)),
             spanned = length(min(year):max(year)),
             coverage = years/spanned) %>%
      filter(coverage >= min_cov) %>%
      select(-years, -spanned, -coverage) %>%
      ungroup()
  }
  return(x)
}

with_max_gap <- function(x, max_gap, edges = TRUE) {
    if (!is.na(max_gap)) {
        country <- yr_obs <- NULL

        c_yrs <- x %>% 
            group_by(country, year) %>% 
            summarize(year = first(year)) %>% 
            mutate(lead_span = ifelse(!is.na(lead(year)),
                                      lead(year) - year - 1,
                                      50),
                   lag_span = ifelse(!is.na(lag(year)),
                                     year - lag(year) - 1,
                                     50),
                   min_span = pmin(lead_span, lag_span),
                   max_span = pmax(lead_span, lag_span),
                   drop = min_span > max_gap & max_span == 50)
        
        x <- x %>% 
          left_join(c_yrs,
                    by = c("country", "year")) %>% 
          filter(!drop) %>% 
          select(-contains("span")) %>% 
          select(-drop)
    }
    return(x)
}

process_dcpo_input_raw <- function(dcpo_input_raw_df) {
  dcpo_input_raw_df %>% 
    with_min_yrs(3) %>% 
    with_min_cy(5) %>% 
    with_min_yrs(3) %>% # double-check after dropping <5 cy
    filter(year >= 1972 & n > 0) %>% 
    group_by(country) %>% 
    mutate(cc_rank = n()) %>% 
    ungroup() %>% 
    arrange(-cc_rank)
}

dcpo_input_raw1 <- dcpo_input_raw %>% 
  filter(!(
    str_detect(survey, "army_wvs") &
      # WVS obs identified as problematic by Claassen
      ((country == "Albania" & year == 1998) |
         (country == "Indonesia" &
            (year == 2001 | year == 2006)) |
         (country == "Iran" & year == 2000) |
         (country == "Pakistan" &
            (year == 1997 | year == 2001)) | # 1996 in Claassen
         (country == "Vietnam" & year == 2001)
      ) |
      (str_detect(item, "strong_wvs") &
         ((country == "Egypt" & year == 2012) |
            (country == "Iran" &
               (year == 2000 | year == 2007)) | # 2005 in Claassen
            (country == "India") |
            (country == "Pakistan" &
               (year == 1997 | year == 2001)) | # 1996 in Claassen
            (country == "Kyrgyzstan" &
               (year == 2003 | year == 2011)) |
            (country == "Romania" &
               (year == 1998 | year == 2005 | year == 2012)) |
            (country == "Vietnam" & year == 2001)
         )) |
      (survey == "pew2002" &
         (country %in% c("Angola", "Bolivia", "Brazil", "China", "Egypt",
         "Guatemala", "Honduras", "India", "Indonesia", "Côte d'Ivoire",
         "Mali", "Pakistan", "Senegal", "Venezuela", "Vietnam"))
         ) |
      (survey == "pew2005" &
         (country %in% c("China", "India", "Morocco", "Pakistan"))
         ) |
      (survey == "pew2007" &
         (country %in% c("Bolivia", "Brazil", "China", "India", "Côte d'Ivoire", "Pakistan", "South Africa", "Venezuela"))
         ) |
      (
        country %in% c(
          "Puerto Rico",
          "Northern Ireland",
          "SrpSka Republic",
          "Hong Kong SAR China"
        )
      )
  )) %>% 
  process_dcpo_input_raw()

n_surveys <- surveys %>% 
  distinct(survey) %>% 
  nrow()

n_items <- dcpo_input_raw1 %>%
  distinct(item) %>% 
  nrow()

n_countries <- dcpo_input_raw1 %>%
  distinct(country) %>% 
  nrow()

n_cy <- dcpo_input_raw1 %>%
  distinct(country, year) %>% 
  nrow() %>% 
  scales::comma()

n_years <- as.integer(summary(dcpo_input_raw1$year)[6]-summary(dcpo_input_raw1$year)[1])

spanned_cy <- dcpo_input_raw1 %>% 
  group_by(country) %>% 
  summarize(years = max(year) - min(year) + 1) %>% 
  summarize(n = sum(years)) %>% 
  pull(n) %>% 
  scales::comma()

total_cy <- {n_countries * n_years} %>% 
  scales::comma()

year_range <- paste("from",
                    summary(dcpo_input_raw$year)[1],
                    "to",
                    summary(dcpo_input_raw$year)[6])

n_cyi <- dcpo_input_raw1 %>% 
  distinct(country, year, item) %>% 
  nrow() %>% 
  scales::comma()

back_to_numeric <- function(string_number) {
  string_number %>% 
    str_replace(",", "") %>% 
    as.numeric()
}

covered_share_of_spanned <- {back_to_numeric(n_cy)/back_to_numeric(spanned_cy) * 100}
```

Recent threats to liberal democracy have manifested as the slow erosion of institutions and norms rather than the sudden and violent takeover of power, the acts of politicians and elected officials rather than admirals and generals.
Considering that the ostensible backing for these antidemocratic office holders is some substantial share of the electorate, understanding the breadth and depth of citizen support for democracy is as important as ever.
On one hand, the breadth of that support for democracy remains truly impressive: @Anderson2021 [, 971-972], for example, estimates that some 90\% of humanity agrees that democracy is the best form of government [see also, e.g., @KirschWelzel2019; @Wuttke2022].
But on the other, a great deal of evidence indicates that is these expressions of support for democracy do not run very deep, that such claims to favor democracy in the abstract do not consistently represent either commitments to _liberal_ democracy or opposition to actions that undermine it [see, e.g., @Bratton2002; @Schedler2007; @Carlin2011; @KiewietdeJonge2016; @Bryan2023].
As a systematic review of this literature emphasizes, "it is important to know not just how strongly citizens support democracy, but also _what kind of democracy it is that they support_" [@Konig2022].

Against this backdrop, a number of prominent recent works have sought to better investigate democratic support as well as its relationships with democratic governance by taking advantage of new latent variable models of public opinion to estimate support for democracy across many countries and over long spans of time.
In this approach, responses to many different survey questions are combined to overcome the sparse and scattered collection of data available on any single question tapping support for democracy; the differences among the various questions used as indicators are accounted for with careful modeling [@Claassen2019; @Solt2020c].
The first of these works, @Claassen2020a, concludes that democratic support so estimated has a positive effect on subsequent democratic change.
Using the same data, @Claassen2020b finds democratic support responds thermostatically to changes in democracy, with democratic retrenchment triggering renewed support.
Again employing these same latent variable estimates of democratic support as well as new estimates generated from additional data on the same set of survey questions, @Tai2022 revisits the analyses of these two articles and demonstrates that the conclusions of both are unsupported.
With a similarly expanded dataset of latent variable estimates of democratic support, @Claassen2022 examines the relationship of democratic support to the performance of democratic governments and concludes that poor government performance does not erode support for democracy.

Several critiques of this impressive line of research have already been raised.
@Hu2022 reveals that the latent variable measure of democratic support used in the several of these works is flawed by errors in the coding of survey questions used as indicators; a replication of @Claassen2020a correcting these errors yields no support for its conclusions.
@Tannenberg2022 [, 602] demonstrates that support for democracy in several indicator questions is biased downward in more autocratic countries due to fear of government reprisal and argues that the resulting latent variable likely suffers from this bias as well.
These critiques are of the 'garbage-in, garbage-out' variety.
That is, they identify problems with the indicator survey questions or their coding that then yield problems in the latent variable that is estimated from these questions.

We offer a more fundamental criticism of this body of work. 
We start by noting that the latent variable estimates are based on the assumption that democratic support falls along a single dimension: some individuals and some populations support democracy wholeheartedly, others fully oppose democracy, and everyone else is somewhere in between these two poles. 
This underlying assumption raises an important question about how democracy itself is conceptualized.
Scholarly understandings of democracy point not to a single definition of the term but instead to multiple meanings.
The Varieties of Democracy (V-Dem) project, for example, anchors its measures in the theoretical ground staked by @Dahl1971; it conceptualizes and measures democracy in a multifacated way that distinguishes among five distinct democratic components---electoral, liberal, participatory, deliberative, and egalitarian [@VDem2023data; @VDem2023codebook]. 
Similarly, prior research in comparative public opinion has cautiously avoided ascribing a single meaning to democracy to the public.  
@Bratton2002 [, 5], for example, argued on the basis of Afrobarometer data that respondents in different countries tend to assign "distinctive, homegrown meanings to democracy." 
Much research on democratic support further underscores the importance of not simply assuming that survey questions regarding support for democracy will mean the same thing to everyone [see, e.g., @Schedler2007; @Konig2022].
These works indicate that support for democracy is a complex and multidimensional phenomenon, contradicting the recent scholarship employing a unidimensional latent variable to measure democratic support. 

Here, we test the validity of the sort of unidimensional measure used in the recent line of latent-variable-driven research by comparing it to responses to questions drawn from many surveys used in the broader literature to map the dimensions of support for liberal democracy and opposition to its erosion.
The results of these validation tests are striking.
Across countries and years, the latent variable of democratic support is essentially orthogonal to these measures of supporting contestation and participation; civil liberties; and institutional constraints on executive power; as well as of prioritizing democracy and political freedom over the economy, economic equality, and order.
Support for democracy in any sort of robust sense is simply not well captured in a latent variable constrained to a single dimension, and research employing such latent variables is therefore best viewed with profound skepticism.
More generally, this result highlights how researchers creating latent variables must be attentive to issues of multidimensionality and provide ample validation for their measures.
The still novel approach to estimating latent variables across countries and over time is a powerful tool, but it does not alone solve all the difficulties of measuring public attitudes.


# The Unidimensional Latent Variable of Democratic Support {.unnumbered}

To provide the strongest test of the validity of the unidimensional latent variable of democratic support, we create the best version of such a variable currently possible.
Following the previous research on this subject, we start by identifying survey questions that asked respondents to choose between democracy and an undemocratic alternative or to evaluate either democracy or one of these undemocratic alternatives. 
Our collection of these questions of express support for democracy in the abstract is similar to but expands on the data presented in Claassen [-@Claassen2020a; -@Claassen2020b] and the larger set collected by @Tai2022.
In all, we identified `r n_items` survey items on support for democracy in the abstract that were asked in no fewer than five country-years in countries surveyed at least three times; these items were drawn from `r n_surveys` different survey datasets.
In accordance with the advice offered by @Hu2022 to avoid data-entry errors by automating data collection, we then used the `DCPOtools` R package [@Solt2019] to compile the responses to these questions.
Finally, we estimated a unidimensional latent variable of democratic support from these responses using the DCPO model presented in @Solt2020c; that work shows that this model provides a better fit to survey questions on express support for democracy in the abstract than the model principally employed in the existing research on this topic, Claassen's [-@Claassen2019] Model 5.
The resulting set of unidimensional latent variable estimates comprises 2,937 country-year observations in 136 countries.
Full details on our collection of survey-question indicators of democratic support and on the resulting latent variable estimates can be found in Appendix A.
The very similar results to the tests below that are obtained when using the estimates generated by Model 5 from the smaller dataset of indicator questions employed in Claassen [-@Claassen2020a; -@Claassen2020b], and @Tai2022 are presented in Appendix C.

```{r dcpo_input, eval=FALSE, include=FALSE, results=FALSE}
dcpo_input <- DCPOtools::format_dcpo(dcpo_input_raw1,
                                     scale_q = most_common_item,
                                     scale_cp = 2)
save(dcpo_input, file = here::here("data", "dcpo_input.rda"))
```

```{r dcpo, eval=FALSE, cache=FALSE, include=FALSE, results=FALSE}
iter <- 1000

dcpo <- cmdstan_model("~/Documents/Projects/DCPO/inst/stan/dcpo.stan")
dcpo_output <- dcpo$sample(
  data = dcpo_input[1:13], 
  max_treedepth = 14,
  adapt_delta = 0.99,
  step_size = 0.005,
  seed = 324, 
  chains = 4, 
  parallel_chains = 4,
  iter_warmup = iter/2,
  iter_sampling = iter/2,
  refresh = iter/50
)
results_path <- here::here(file.path("data", 
                                     iter, 
                                     {str_replace_all(Sys.time(), "[- :]", "") %>%
                                         str_replace("\\d{2}$", "")}))
dir.create(results_path, 
           showWarnings = FALSE, 
           recursive = TRUE)
dcpo_output$save_data_file(dir = results_path,
                           random = FALSE)
dcpo_output$save_output_files(dir = results_path,
                              random = FALSE)
```

```{r dcpo_results, cache=FALSE}
if (!exists("results_path")) {
  latest <- "202301131531"
  results_path <- here::here("data", "1000", latest)
  
  # Define OSF_PAT in .Renviron: https://docs.ropensci.org/osfr/articles/auth
  if (!file.exists(file.path(results_path, paste0("dcpo-", latest, "-1.csv")))) {
    dir.create(results_path, showWarnings = FALSE, recursive = TRUE)
    osf_retrieve_node("ksa4r") %>% 
      osf_ls_files(pattern = "csv$") %>% 
      osf_download(path = here::here("data", "1000"))
  }
  
  if(!file.exists(here::here("data", "dcpo_output.rds"))) {
    dcpo_output <- as_cmdstan_fit(here::here(results_path,
                                         list.files(results_path, pattern = "csv$")))
    
    dcpo_output$save_object(here::here("data", "dcpo_output.rds"))
  }
}

dcpo_output <- readRDS(here::here("data", "dcpo_output.rds"))
```

```{r dcpo_summary}
load(file = here::here("data", "dcpo_input.rda"))
theta_summary <- DCPOtools::summarize_dcpo_results(dcpo_input,
                                                   dcpo_output,
                                                   "theta")

res_cy <- nrow(theta_summary) %>% 
  scales::comma()

res_c <- theta_summary %>% 
  pull(country) %>% 
  unique() %>% 
  length()

save(theta_summary, file = here::here("data","theta_summary.rda"))
```

```{r theta_results}
theta_results <- extract_dcpo_results(dcpo_input,
                                      dcpo_output,
                                      par = "theta")
```

# Testing the Validity of Democratic Support as a Unidimensional Latent Variable {.unnumbered}

To test the validity of the unidimensional latent variable measure of democratic support, we compare it to a range of questions from multi-wave cross-national surveys that also address various aspects of support for democracy; that is, we provide a series of tests of convergent validation [see @Adcock2001, 540].
Because these survey questions were not used to estimate the latent variable---again, those indicators ask respondents to evaluate 'democracy' or a specific undemocratic alternative---they constitute "external" validation tests [see @Caughey2019, 684-685].
Among various theories of democracy, we specifically consider Dahl's polyarchy. 
In particular, we use questions that reference Dahl's [-@Dahl1971, 3-4] two "theoretical dimensions of democratization," public contestation and inclusive participation, and the institutionally guaranteed civil rights and liberties they comprise.
This criteria is not only used in many studies on support for democracy but also highly related to the concerns of backsliding [e.g., @Ananda2023; @Gora2022; @Meyerrose2023]. 
In light of recent concerns that citizens do not always prioritize the preferences for democracy they express, we also draw on questions that assess democracy's relative importance.

```{r v_data, include=FALSE}
v_titles <- here("data-raw", "validation_items.csv") %>%
    read_csv(col_types = "ccccccc") %>%
    select(item, title, neg, group, svy_grp) %>%
    distinct() %>% 
    mutate(title = paste0(svy_grp, ": ", title))

v_raw <- here("data-raw", "validation_items.csv") %>%
    read_csv(col_types = "ccccccc") %>%
    DCPOtools::dcpo_setup(datapath = here("..",
                                          "data",
                                          "dcpo_surveys")) %>%
    left_join(v_titles, by = "item")
```

```{r polyarchy, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Polyarchy Survey Items \\label{polyarchy}", fig.height=3, cache=FALSE, fig.pos='h'}
v_vars_poly <- v_raw %>%
    filter(group == "contest" | group == "participation") %>% 
    arrange(group, title) 

validation_plot(v_vars_poly, lab_x = .5, lab_y = 15) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 9),
        strip.text.x = element_text(size=5),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support",
       y = "% Agreeing")
```

We start with survey questions that most directly address public constestation and inclusive participation.
For example, the AmericasBarometer asks whether chief executives should "limit the voice and vote of opposition parties," the Asian Barometer questions whether "people with little or no education should have as much say in politics as highly-educated people," and at the two dimensions' point of greatest overlap, the Afrobarometer asks whether "we should choose our leaders in this country through regular, open and honest elections."
Scatter plots of the aggregate responses to these questions and other similar items against the unidimensional latent variable of support for democracy in the abstract are presented in Figure\nobreakspace{}\@ref(fig:polyarchy).
It is evident from a glance that all of these relationships are extremely weak, essentially null.
Support for democracy in the abstract as measured by a unidimensional latent variable has very little do with attitudes toward these core features of liberal democracy.

```{r liberties, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Civil Liberties Survey Items \\label{liberties}", fig.height=4, fig.pos='h'}

v_vars_lib <- v_raw %>%
    filter(str_detect(group, "free")) %>% 
    arrange(desc(group), title) 

validation_plot(v_vars_lib) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=6),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support",
       y = "% Agreeing")
```

```{r institutions, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Democratic Institutions Survey Items \\label{institutions}", fig.height=3, fig.pos='h'}

v_vars_inst <- v_raw %>%
    filter(group == "rule_of_law" | group == "no_leg") %>% 
    arrange(desc(group), title) 

validation_plot(v_vars_inst) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=7),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support",
       y = "% Agreeing")
```

Next, we consider the survey questions that examine the level of support for civil liberties.
We compiled four items regarding free speech, three on freedom of the press, three more on freedom of assembly, and two that deal with freedom of association.
Scatter plots of the aggregate responses to these questions against the unidimensional latent variable of democratic support are presented in Figure\nobreakspace{}\@ref(fig:liberties).
All of these correlations are weak to very weak, and several are in the opposite of the expected direction.
For example, across five waves of the Asian Barometer, the unidimensional latent variable of democratic support has a _positive_ relationship ($R~=~0.28$) with aggregate agreement with the statement, "The government should decide whether certain ideas should be allowed to be discussed in society."
Support for democracy in the abstract appears not to conflict with favoring government censorship in those countries and years. 
The strongest relationship with democratic support so measured is found with an item on protests from the surveys composing the Consolidation of Democracy in Central and Eastern Europe dataset, which asked respondents the extent of their agreement with "the government passing a law to forbid all public protest demonstrations."
That correlation reaches only $R~=~−0.39$, and that in a rather thin evidentiary base of just 21 country-years.
Even then, it stands out as an exception rather than the rule.
The unidimensional latent variable of democratic support does not capture much of the variation across countries and over time of public demand that civil liberties are respected.

Figure\nobreakspace{}\@ref(fig:institutions) turns to the institutions that guarantee citizens' rights and liberties from government abuse, i.e., courts and the rule of law, and those that make government policies depend on citizen preferences, that is, legislatures.
The unidimensional latent variable relates only very weakly with aggregate agreement with rule of law items like the Afrobarometer question, "the President/Prime Minister must always obey the laws and the courts, even if he thinks they are wrong."
Its correlations with items specifically on legislative checks, like the AmericasBarometer's "when the Congress hinders the work of our government, our presidents should govern without the Congress," are perhaps a bit stronger, but remain unimpressive.
Support for democracy in the abstract, even in the form of a latent variable, has little relationship with support for the checks and balances of horizontal accountability.

```{r conditions, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Prioritization Survey Items \\label{conditions}", fig.height=3, fig.pos='h'}

v_vars_cond <- v_raw %>%
    filter(str_detect(group, "pref_")) %>% 
    arrange(desc(group), title) 

validation_plot(v_vars_cond, lab_x = .45, lab_y = 10) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=7),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support",
       y = "% Agreeing")
```

As mentioned above, recent research has documented that many who proclaim support for democracy in the abstract nevertheless have other preferences---such as those regarding policy or partisanship---that they may consider to be more important priorities [e.g., @Graham2020; @Simonovits2022; see also @Krishnarajan2022].
Survey questions on the public's prioritization of democracy are relatively rare, but we found seven relevant items.
Most straightforwardly asked respondents to choose between democracy or political freedom on the one hand and maintaining order, reducing economic inequality, or spurring economic development on the other, though the AmericasBarometer asked, "would a military coup be justified under the following circumstances: when social protest is high."
Figure\nobreakspace{}\@ref(fig:conditions) shows that the unidimensional latent variable of democratic support bears almost no relationship at all to the aggregated responses to these questions.

# Conclusions {.unnumbered}
We draw two straightforward conclusions.
The first reinforces the extensive literature on democratic support. Support for democracy is a complex, multidimensional concept, and many who profess to support democracy in the abstract nevertheless also endorse a variety of illiberal and undemocratic actions.
Therefore, unidimensional measures---including those used in Claassen [-@Claassen2020a; -@Claassen2020b], @Tai2022, and @Claassen2022---are inappropriate both as a general matter and in particular with regard to research seeking to address concerns of backsliding among liberal democracies.

The second is more general.
Advances in computer hardware and Bayesian software have made estimating latent variables a powerful tool for studying public opinion.
But latent variables of public opinion, no matter how sophisticated, are not guaranteed to be good measures of the concepts that are important to us.
As with any newly proposed measure, validation tests of these latent variables are crucially important [exemplars include @Caughey2019, 686-691; @Woo2022, 7-8], and measures that fall short in these tests cannot serve as solid foundations for research.


# References {.unnumbered}

::: {#refs-text}
:::

\pagebreak

```{=tex}
\renewcommand{\baselinestretch}{1}
\selectfont
\maketitle
\selectfont
```
```{=tex}
\pagenumbering{arabic}
\renewcommand*{\thepage}{A\arabic{page}}
```
```{=tex}
\setcounter{figure}{0}
\renewcommand*{\thefigure}{A\arabic{figure}}
```
```{=tex}
\vspace{-.7in}
\begin{center}
\begin{Large}
Appendices
\end{Large}
\end{center}
```
# Appendix A: The Unidimensional Latent Variable of Democratic Support {.unnumbered}

We created the unidimensional latent variable of democratic support used here by first collecting survey questions that asked respondents to choose between democracy and an undemocratic alternative or to evaluate either democracy or one of these undemocratic alternatives. 
Our collection of such questions is similar to but expands on the data presented in @Claassen2020a and the larger set collected by @Tai2022.
In all, we identified `r n_items` survey items on support for democracy in the abstract that were asked in no fewer than five country-years in countries surveyed at least three times; these items were drawn from `r n_surveys` different survey datasets.

```{r itemcountry, fig.cap="Countries and Years with the Most Observations in the Source Data \\label{item_country_plots}", fig.height=3.5, fig.pos='h', cache=FALSE}
items_plot <- dcpo_input_raw1 %>%
  distinct(country, year, item) %>%
  count(item) %>%
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(item, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Country-Years\nObserved") +
  ggtitle("Items")

countries_plot <- dcpo_input_raw1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country)) %>% 
  distinct(country, year, item) %>% 
  count(country) %>%
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(country, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95, size = 7),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Year-Items\nObserved") +
  ggtitle("Countries")

cby_plot <- dcpo_input_raw1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  ggplot(aes(forcats::fct_reorder(country, n, .desc = TRUE), n)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  ylab("Years\nObserved") +
  ggtitle("Countries")

ybc_plot <- dcpo_input_raw1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>%
  ggplot(aes(year, nn)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        # axis.text.x  = element_text(angle = 90, vjust = .45, hjust = .95),
        axis.text.x = element_text(size = 7),
        axis.title.y = element_text(size = 9),
        plot.title = element_text(hjust = 0.5, size = 11)) +
  xlab("Year") +
  ylab("Countries\nObserved") +
  ggtitle("Year")

world_map <- map_data("world") %>% 
  filter(!long > 180)

cby_map <- world_map %>% 
  distinct(region) %>% 
  mutate(country = countrycode::countrycode(region,
                                            "country.name",
                                            "country.name")) %>% 
  filter(!region=="Antarctica") %>% 
  left_join(dcpo_input_raw1 %>% 
              count(country, year) %>% 
              count(country, name = "Years"),
            by = "country") %>% 
  mutate(Years = ifelse(is.na(Years), 0, Years)) %>% 
  ggplot(aes(fill = Years, map_id = region)) +
  geom_map(map = world_map,
           color = "white",
           size = 0.06) +
  coord_map(projection = "mollweide", 
            ylim=c(-80, 90),
            xlim=c(-170, 170)) +
  theme_void() +
  scale_fill_distiller(na.value = "gray90", 
                       palette = "Blues",
                       direction = 1) +
  ggtitle("Years Observed by Country") +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = c(.05,.1),
        legend.justification = c(0,0), 
        legend.direction = "vertical") +
  scale_y_continuous(expand=c(0,0)) +
  scale_x_continuous(expand=c(0,0))

cby_map + (countries_plot/ ybc_plot) + plot_layout(widths = c(4, 1))
```

```{r most_common}
most_common_item <- dcpo_input_raw1 %>% 
  count(item) %>% 
  arrange(-n) %>% 
  slice_head() %>% 
  pull(item)

most_common_item_cy <- dcpo_input_raw1 %>% 
  filter(item == most_common_item) %>%
  distinct(country, year) %>%
  nrow()

most_common_item_surveys <- dcpo_input_raw1 %>%
  filter(item == most_common_item) %>%
  distinct(survey) %>%
  pull(survey) %>% 
  str_split(", ") %>% 
  unlist() %>% 
  unique() %>% 
  sort()

top_country_cyi <- dcpo_input_raw1 %>% 
  distinct(country, year, item) %>%
  count(country) %>%
  arrange(-n) %>% 
  slice_head() %>%
  pull(country)

top_country_cyi_obs <- dcpo_input_raw1 %>%
  filter(country == top_country_cyi) %>%
  distinct(country, year, item) %>%
  nrow()

top_country_cy <- dcpo_input_raw1 %>% 
  count(country, year) %>% 
  count(country) %>% 
  arrange(-n) %>% 
  slice_head() %>% 
  pull(country)

top_country_cy_obs <- dcpo_input_raw1 %>%
  filter(country == top_country_cy) %>%
  distinct(country, year) %>%
  nrow()

countries_cp <- dcpo_input_raw1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year, item) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  pull(country)

countries_cbyp <- dcpo_input_raw1 %>%
  mutate(country = if_else(stringr::str_detect(country, "United"),
                           stringr::str_replace(country, "((.).*) ((.).*)", "\\2.\\4."),
                           country),
         country = stringr::str_replace(country, "South", "S.")) %>% 
  distinct(country, year) %>%
  count(country) %>% 
  arrange(desc(n)) %>% 
  head(12) %>% 
  pull(country)

adding <- setdiff(countries_cbyp, countries_cp) %>% 
  knitr::combine_words()

dropping <- setdiff(countries_cp, countries_cbyp) %>% 
  knitr::combine_words()

y_peak_year <- dcpo_input_raw1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>% 
  filter(nn == max(nn)) %>% 
  pull(year)

y_peak_nn <- dcpo_input_raw1 %>%
  distinct(country, year) %>%
  count(year, name = "nn") %>% 
  filter(nn == max(nn)) %>% 
  pull(nn)

data_poorest <- dcpo_input_raw1 %>%
  distinct(country, year) %>%
  count(country) %>%
  arrange(n) %>%
  filter(n == min(n)) %>%
  pull(country) %>% 
  knitr::combine_words() %>% 
  paste0("---", ., "---")

wordify_numeral <- function(x) setNames(c("one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", " seventeen", "eighteen", "nineteen"), 1:19)[x]

n_data_poor <- {data_poorest %>%
    str_split(",") %>% 
    first()} %>% 
  length() 

if (n_data_poor < 20) {
  n_data_poorest <- n_data_poor %>% 
    wordify_numeral()
} else {
  n_data_poorest <- n_data_poor
  data_poorest <- " "
}

```

Together, the survey items in the source data were asked in `r n_countries` countries in three or more time points over the `r n_years` years from `r year_range`, giving us a total of `r n_cyi` country-year-item observations.

The most frequently-asked item in the data we collected appears in `r length(most_common_item_surveys)` different survey datasets, covering a total of `r most_common_item_cy` different country-years.
It asks respondents whether they strongly disagree, disagree, agree, or strongly agree with the statement, "Democracy may have its problems but it is still the best form of government," a four-point version of the so-called Churchill item.

The left panel of Figure\nobreakspace{}\ref{item_country_plots} presents a choropleth map indicating the number of years observed in the source data for each country.
`r top_country_cy` leads in this regard; it was observed in `r top_country_cy_obs` different years.
Thanks in part to sustained interest in democratic support in the Latinobarómetro and the Americas Barometer, most Latin America countries were surveyed in at least 25 years.
Germany, Poland, Ukraine, and Russia were all surveyed in more than 20 years.
At the other end of the spectrum, `r n_data_poorest` countries have only the minimum three survey years required to be included in the source dataset at all.

The upper right panel of this figure shows the twelve countries with the most year-items in the source data.
It reveals that South Korea enjoys the richest collection of data on support for democracy.
In addition to countries already mentioned, Japan and the Philippines were also surveyed often and with multiple different items.
The lower right panel counts the countries observed in each year and reveals that relatively few countries were surveyed before the mid-1990s.
Country coverage reached its peak in `r y_peak_year`, when respondents in `r y_peak_nn` countries were asked items about support for democracy in the abstract.  Figure\nobreakspace{}\ref{obs_by_cy} provides additional detail on the source data, presenting the number of items observed in each country-year; countries are listed on the right in order of the number of years observed. 

In accordance with the advice offered by @Hu2022 to avoid data-entry errors by automating data collection, we used the `DCPOtools` R package [@Solt2019] to compile the responses to these questions.
Then, following the existing literature [Claassen -@Claassen2020a; -@Claassen2020b; @Tai2022; @Claassen2022], we use this collection of survey data to generate a complete time series using a latent variable model.
Finally, we estimated a unidimensional latent variable of democratic support from these responses using the DCPO model presented in @Solt2020c, running four chains for 1,000 iterations each and discarding the first half as warmup, which left us with 2,000 samples.
The $\hat{R}$ diagnostic had a maximum value of 1.02, indicating that the model converged.
The dispersion parameters of the survey items indicate that all of them load well on the latent variable (see Table A1).

```{r obs, fig.cap = "Source Data Observations by Country and Year \\label{obs_by_cy}", fig.height = 9}
dcpo_input_raw1 %>%
  mutate(country = str_replace(country, "’", "'")) %>%
  group_by(country) %>%
  mutate(years_rank = length(unique(year))) %>%
  distinct(country, year, item, cc_rank, years_rank) %>%
  group_by(country, year) %>%
  summarize(n = n(),
            cc_rank = cc_rank,
            years_rank = years_rank) %>%
  ungroup() %>%
  distinct() %>%
  ggplot(aes(x = year,
             y = forcats::fct_reorder(country, years_rank),
             fill = n)) +
  geom_tile() +
  scale_fill_stepsn(colors = rev(hcl.colors(5, "inferno")),
                    n.breaks = 5,
                    show.limits = TRUE,
                    right = FALSE,
                    name = "Observations") +
  labs(x = NULL, y = NULL) +
  scale_x_continuous(breaks=seq(1972, 2020, 4),
                     sec.axis = dup_axis()) +
  scale_y_discrete(position = "right") +
  theme(legend.justification=c(0, 0),
        legend.position=c(0.01, 0.01),
        axis.text.y  = element_text(size = 6))
```

```{r p1_data}
n_panes <- 2
axis_text_size <- 10

p1_data <- theta_summary %>%
  group_by(country) %>%
  top_n(1, year) %>%
  ungroup() %>%
  arrange(mean) %>%
  transmute(country_year = paste0(country, " (", year, ")") %>% 
              str_replace("’", "'"),
            estimate = mean,
            conf.high = q90,
            conf.low = q10,
            pane = n_panes - (ntile(mean, n_panes) - 1),
            ranked = as.factor(ceiling(row_number())))

top5 <- p1_data %>% 
  arrange(desc(ranked)) %>% 
  slice(1:5) %>% 
  pull(country_year) %>% 
  str_replace(" \\(.*", "") %>% 
  knitr::combine_words()

bottom5 <- p1_data %>% 
  arrange(ranked) %>% 
  slice(1:5) %>% 
  pull(country_year) %>% 
  str_replace(" \\(.*", "") %>% 
  knitr::combine_words()
```

The result is unidimensional estimates of support for democracy in the abstract in the `r res_cy` country-years spanned by the source data.
Figure\nobreakspace{}\ref{cs_mry} displays the most recent available score for each of the `r res_c` countries and territories in the dataset.
The latest scores for `r top5` have them as the places where the public expresses the greatest support for democracy in the abstract on this unidimensional scale; `r bottom5` are the places where the public expresses the least support for democracy by this measure.

```{r cs, fig.cap="The Unidimensional Latent Variable of Democratic Support, Most Recent Available Year \\label{cs_mry}", fig.height=10, fig.width=8}
p_theta <- ggplot(p1_data,
                  aes(x = estimate, y = ranked)) +
  geom_segment(aes(x = conf.low, xend = conf.high,
                   y = ranked, yend = ranked),
               na.rm = TRUE,
               alpha = .4) +
  geom_point(fill = "black", shape = 21, size = .5, na.rm = TRUE) +
  theme_bw() + theme(legend.position="none",
                     axis.text.x  = element_text(size = axis_text_size,
                                                 angle = 90,
                                                 vjust = .45,
                                                 hjust = .95),
                     axis.text.y  = element_text(size = axis_text_size),
                     axis.title = element_blank(),
                     strip.background = element_blank(), 
                     strip.text = element_blank(),
                     panel.grid.major = element_line(size = .3),
                     panel.grid.minor = element_line(size = .15)) +
  scale_y_discrete(breaks = p1_data$ranked, labels=p1_data$country_year) +
  coord_cartesian(xlim=c(0, 1)) +
  facet_wrap(vars(pane), scales = "free", nrow = 1)

p_theta +
  plot_annotation(caption = "Note: Gray whiskers represent 80% credible intervals.")

```

\clearpage
\pagebreak
\noindent Table A1: Indicators Used in the Unidimensional Latent Variable Model of Democratic Support

```{r dsd_items}
alpha_results <- summarize_dcpo_results(dcpo_input,
                                        dcpo_output = dcpo_output,
                                        pars = "alpha") %>% 
  transmute(item = question,
            dispersion = mean)

beta_results <- summarize_dcpo_results(dcpo_input,
                                       dcpo_output,
                                       "beta") %>% 
  group_by(question) %>% 
  summarize(difficulties0 = paste0(sprintf("%.2f", round(mean, 2)),
                                   collapse = ", ")) %>% 
  mutate(item = question,
         cp = if_else(str_detect(item, "threestate"),
                      2, 
                      as.numeric(str_extract(item, "\\d+")) - 1),
         term = str_glue("(( ?-?[0-9].[0-9][0-9]?,?){{{cp}}})"),
         difficulties = str_extract(difficulties0, 
                                    term) %>%
           str_replace(",$", "") %>% 
           str_trim()) %>% 
  transmute(item, difficulties)
                                    
items_summary <- dcpo_input_raw1 %>%
  dplyr::select(country, year, item, survey) %>%
  distinct() %>%
  separate(survey, c("surv1", "surv2", "surv3"), sep=", ", fill = "left") %>%
  pivot_longer(cols = starts_with("surv"), values_to = "survey") %>%
  filter(!is.na(survey)) %>% 
  group_by(item) %>% 
  mutate(survey = str_extract(survey, "^[a-z]*"),
         all_surveys = paste0(unique(survey), collapse = ", ")) %>% 
  ungroup() %>% 
  distinct(country, year, item, .keep_all = TRUE) %>% 
  group_by(item) %>% 
  mutate(n_cy = n()) %>% 
  ungroup() %>%
  distinct(item, n_cy, all_surveys) %>% 
  left_join(surveys %>%
              select(item, question_text, response_categories) %>%
              distinct(item, .keep_all = TRUE),
            by = "item") %>% 
  left_join(alpha_results, by = "item") %>% 
  left_join(beta_results, by = "item") %>% 
  arrange(-n_cy)
```

```{r dsd_items_table}  
items_summary %>% 
  transmute(`Survey\nItem\nCode` = item,
            `Country-Years` = as.character(n_cy),
            `Question Text` = str_replace(question_text, "([^(]*)\\(.*", "\\1"),
            `Response Categories` = response_categories,
            `Dispersion` = dispersion,
            `Difficulties`= difficulties,
            `Survey Dataset Codes` = all_surveys) %>% 
  modelsummary::datasummary_df(output = "kableExtra",
                               longtable = TRUE) %>% 
  # modelsummary::datasummary_df(output = "kableExtra",
  #                              note = "",
  #                              longtable = TRUE,
  #                              caption = "Indicators Used in the Unidimensional Model of Democratic Support") %>%
  kableExtra::column_spec(1, width = "7em") %>%
  kableExtra::column_spec(2, width = "4em") %>%
  kableExtra::column_spec(3, width = "13em") %>%
  kableExtra::column_spec(4, width = "16em") %>%
  kableExtra::column_spec(5, width = "4em") %>%
  kableExtra::column_spec(c(6, 7), width = "8em") %>% 
  kableExtra::kable_styling(font_size = 7) %>%
  kableExtra::kable_styling(latex_options = c("repeat_header")) %>%
  kableExtra::kable_styling(latex_options = "striped")
```

\clearpage
\pagebreak
# Appendix B: Validation Survey Items

\noindent Table A2: Survey Items Used in Validation Tests

```{r v_items, cache=FALSE}
v_items <- v_raw %>%
  dplyr::select(country, year, item, survey) %>%
  distinct() %>%
  separate(survey, c("surv1", "surv2", "surv3"), sep=", ", fill = "left") %>%
  pivot_longer(cols = starts_with("surv"), values_to = "survey") %>%
  filter(!is.na(survey)) %>% 
  group_by(item) %>% 
  mutate(survey = str_extract(survey, "^[a-z]*"),
         all_surveys = paste0(unique(survey), collapse = ", ")) %>% 
  distinct(country, year, item, .keep_all = TRUE) %>% 
  mutate(n_cy = n()) %>% 
  ungroup() %>%
  distinct(item, n_cy, all_surveys) %>% 
  left_join(here("data-raw", "validation_items.csv") %>%
              read_csv(col_types = "ccccccc") %>%
              mutate(title = paste0(svy_grp, ": ", title)) %>% 
              select(item, title,
                     question_text, group) %>%
              distinct(title, .keep_all = TRUE),
            by = "item") %>%
  arrange(title) %>% 
  select(title, n_cy, question_text)
```

```{r v_items_table, cache=FALSE}  
v_items %>% 
  transmute(`Title` = title,
            `Country-Years` = as.character(n_cy),
            `Question Text` = question_text) %>% 
  modelsummary::datasummary_df(output = "kableExtra",
                               longtable = TRUE) %>% # ,
  #                              note = "",
  #                              caption = "Survey Items Used in Validation Tests") %>% 
  kableExtra::column_spec(1, width = "14em") %>%
  kableExtra::column_spec(2, width = "4em") %>%
  kableExtra::column_spec(3, width = "45em") %>%
  kableExtra::kable_styling(font_size = 7) %>%
  kableExtra::kable_styling(latex_options = c("repeat_header")) %>%
  kableExtra::kable_styling(latex_options = "striped")
```

\clearpage
\pagebreak
# Appendix C: Results with an Alternate Latent Variable and Restricted Set of Indicator Data

To provide the best test of the unidimensional latent variable approach for measuring democratic support, in the main text the latent variable is estimated using the largest indicator dataset currently available and the DCPO model, which @Solt2020c demonstrates fits these data better than the alternatives.
However, the existing scholarship taking this approach uses a considerably smaller dataset of responses to these indicators and Claassen's [-@Claassen2019] Model 5 [see Claassen -@Claassen2020a; -@Claassen2020b; @Tai2022; @Claassen2022].
To verify our findings, we replicate the figures of the text while instead using this latter latent variable of democratic support with corrections for the data-entry errors identified in @Hu2022.

```{r m5_functions}
summarize_cm5_results <- function(cm5_input,
                                  cm5_output,
                                  pars = c("theta"),
                                  probs = c(.1, .9)) {
    
    question <- country <- year <- parameter <- variable <- kk <- tt <- qq <- rr <- NULL
    
    dat <- cm5_input$data
    
    qcodes <- dat %>%
        dplyr::transmute(item = item,
                         qq = as.numeric(as.factor(item))) %>% 
        unique()
    
    kcodes <- dat %>%
        dplyr::transmute(country = country,
                         kk = as.numeric(as.factor(country))) %>% 
        unique()
    
    tcodes <- tibble(year = min(dat$year):max(dat$year),
                     tt = year - min(year) + 1)
    
    ktcodes <- dat %>%
        dplyr::group_by(country) %>%
        dplyr::summarize(first_yr = min(year),
                         last_yr = max(year))
    
    if ("R6" %in% class(cm5_output)) {
        fit <- cm5_output
        
        summary_measures <- c("mean", "median", "sd", "mad", "rhat", "ess_bulk", "ess_tail")
        
        res <- map_df(pars, function(par) {
            if (par == "theta") {
                fit$summary("theta",
                            ~posterior::quantile2(., probs = probs),
                            summary_measures) %>%
                    dplyr::mutate(tt = as.numeric(gsub("theta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       variable)),
                                  kk = as.numeric(gsub("theta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       variable))) %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::left_join(tcodes, by = "tt") %>%
                    dplyr::left_join(ktcodes, by = "country") %>%
                    dplyr::filter(year >= first_yr) %>% # & year <= last_yr
                    dplyr::arrange(kk, tt) %>%
                    dplyr::select(country, year,
                                  starts_with("me"),
                                  sd, mad, starts_with("q"),
                                  rhat, starts_with("ess"),
                                  variable, kk, tt)
            } else if (par == "sigma") {
                fit$summary("sigma",
                            ~posterior::quantile2(., probs = probs),
                            summary_measures) %>%
                    dplyr::mutate(tt = as.numeric(gsub("sigma\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       variable)),
                                  kk = as.numeric(gsub("sigma\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       variable))) %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::left_join(tcodes, by = "tt") %>%
                    dplyr::mutate(year = if_else(tt == 1,
                                                 as.integer(year),
                                                 as.integer(min(year, na.rm = TRUE) + tt - 1))) %>%
                    dplyr::left_join(ktcodes, by = "country") %>%
                    dplyr::filter(year >= first_yr & year <= last_yr) %>%
                    dplyr::arrange(kk, tt) %>%
                    dplyr::select(country, year,
                                  starts_with("me"),
                                  sd, mad, starts_with("q"),
                                  rhat, starts_with("ess"),
                                  variable, kk, tt)
            } else if (par == "alpha") {
                fit$summary("alpha",
                            ~posterior::quantile2(., probs = probs),
                            summary_measures) %>%
                    dplyr::mutate(qq = as.numeric(gsub("alpha\\[(\\d+)]",
                                                       "\\1",
                                                       variable))) %>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::arrange(qq) %>%
                    dplyr::select(question, n, everything())
            } else if (par == "beta") {
                fit$summary("beta",
                            ~posterior::quantile2(., probs = probs),
                            summary_measures) %>%
                    dplyr::mutate(rr = as.numeric(gsub("beta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       variable)),
                                  qq = as.numeric(gsub("beta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       variable)))%>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::arrange(qq, rr) %>%
                    dplyr::filter(rr <= rr_max) %>%
                    dplyr::select(question, n, everything())
            } else if (par == "delta") {
                fit$summary("delta",
                            ~posterior::quantile2(., probs = probs),
                            summary_measures) %>%
                    dplyr::mutate(qq = as.numeric(gsub("delta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       parameter)),
                                  kk = as.numeric(gsub("delta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       parameter)))%>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::arrange(qq) %>%
                    dplyr::select(question, n, country, everything())
            }
        })
    } else {
        res <- map_df(pars, function(par) {
            if (par == "theta") {
                rstan::summary(dcpo_output, pars = "theta", probs = probs) %>%
                    dplyr::first() %>%
                    as.data.frame() %>%
                    tibble::rownames_to_column("parameter") %>%
                    tibble::as_tibble() %>%
                    dplyr::mutate(tt = as.numeric(gsub("theta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       parameter)),
                                  kk = as.numeric(gsub("theta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       parameter))) %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::left_join(tcodes, by = "tt") %>%
                    dplyr::mutate(year = if_else(tt == 1,
                                                 as.integer(year),
                                                 as.integer(min(year, na.rm = TRUE) + tt - 1))) %>%
                    dplyr::left_join(ktcodes, by = "country") %>%
                    dplyr::filter(year >= first_yr & year <= last_yr) %>%
                    dplyr::arrange(kk, tt) %>%
                    dplyr::select(-first_yr, -last_yr)
            } else if (par == "sigma") {
                rstan::summary(dcpo_output, pars = "sigma", probs = probs) %>%
                    dplyr::first() %>%
                    as.data.frame() %>%
                    tibble::rownames_to_column("parameter") %>%
                    tibble::as_tibble() %>%
                    dplyr::mutate(tt = as.numeric(gsub("sigma\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       parameter)),
                                  kk = as.numeric(gsub("sigma\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       parameter))) %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::left_join(tcodes, by = "tt") %>%
                    dplyr::arrange(kk, tt)
            } else if (par == "alpha") {
                rstan::summary(dcpo_output, pars = "alpha", probs = probs) %>%
                    dplyr::first() %>%
                    as.data.frame() %>%
                    tibble::rownames_to_column("parameter") %>%
                    tibble::as_tibble() %>%
                    dplyr::mutate(qq = as.numeric(gsub("alpha\\[(\\d+)]",
                                                       "\\1",
                                                       parameter))) %>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::arrange(qq)
            } else if (par == "beta") {
                rstan::summary(dcpo_output, pars = "beta", probs = probs) %>%
                    dplyr::first() %>%
                    as.data.frame() %>%
                    tibble::rownames_to_column("parameter") %>%
                    tibble::as_tibble() %>%
                    dplyr::mutate(rr = as.numeric(gsub("beta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       parameter)),
                                  qq = as.numeric(gsub("beta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       parameter)))%>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::arrange(qq, rr)
            } else if (par == "delta") {
                rstan::summary(dcpo_output, pars = "delta", probs = probs) %>%
                    dplyr::first() %>%
                    as.data.frame() %>%
                    tibble::rownames_to_column("parameter") %>%
                    tibble::as_tibble() %>%
                    dplyr::mutate(qq = as.numeric(gsub("delta\\[(\\d+),\\d+\\]",
                                                       "\\1",
                                                       parameter)),
                                  kk = as.numeric(gsub("delta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       parameter)))%>%
                    dplyr::left_join(qcodes, by = "qq") %>%
                    dplyr::left_join(kcodes, by = "kk") %>%
                    dplyr::arrange(qq)
            }
        })
    }
    
    return(res)
}

extract_m5_results <- function(cm5_input,
                               cm5_output,
                               par = "theta") {
  
    if (!par %in% c("theta")) {
        errorCondition('extract_m5_results() currently extracts only "theta"')
    }

    question <- country <- year <- parameter <- variable <- kk <- tt <- qq <- rr <- NULL
    
    dat <- cm5_input$data
    
    qcodes <- dat %>%
        dplyr::transmute(item = item,
                         qq = as.numeric(as.factor(item))) %>% 
        unique()
    
    kcodes <- dat %>%
        dplyr::transmute(country = country,
                         kk = as.numeric(as.factor(country))) %>% 
        unique()
    
    tcodes <- tibble(year = min(dat$year):max(dat$year),
                     tt = year - min(year) + 1)
    
    ktcodes <- dat %>%
        dplyr::group_by(country) %>%
        dplyr::summarize(first_yr = min(year),
                         last_yr = max(year))

    if ("R6" %in% class(cm5_output)) {
        fit <- cm5_output

        suppressWarnings(
            res <- fit$draws(par,
                             format = "df") %>%
                pivot_longer(starts_with(par),
                             values_to = par) %>%
                {if (par == "theta") {
                    dplyr::mutate(., tt = as.numeric(gsub("theta\\[(\\d+),\\d+\\]",
                                                          "\\1",
                                                          name)),
                                  kk = as.numeric(gsub("theta\\[\\d+,(\\d+)\\]",
                                                       "\\1",
                                                       name))) %>%
                        dplyr::left_join(kcodes, by = "kk") %>%
                        dplyr::left_join(tcodes, by = "tt") %>%
                        dplyr::mutate(year = if_else(tt == 1,
                                                     as.integer(year),
                                                     as.integer(min(year, na.rm = TRUE) + tt - 1))) %>%
                        dplyr::left_join(ktcodes, by = "country") %>%
                        dplyr::filter(year >= first_yr & year <= last_yr) %>%
                        dplyr::arrange(kk, tt) %>%
                        dplyr::select(country, year, theta, draw = .draw)
                }}) %>%
            dplyr::group_split(draw) %>%
            purrr::map(~select(.x, -draw))
    } else {
        message("extract_m5_results() cannot currently handle rstan output")
    }
    return(res)
}
```

```{r m5_data, include=FALSE}
m5_path <- here::here("data", "m5")

# Define OSF_PAT in .Renviron: https://docs.ropensci.org/osfr/articles/auth
dir.create(m5_path, showWarnings = FALSE, recursive = TRUE)
osf_retrieve_node("vmxkn") %>%
    osf_ls_files(pattern = "csv$") %>% 
    osf_download(path = m5_path,
                 conflicts = "skip")


m5_output <- as_cmdstan_fit(here::here(m5_path,
                                       list.files(m5_path,
                                                  pattern = "csv$")))

m5_input <- rio::import(here::here("data",
                                   "m5",
                                   "claassen_replication_input.rda"))

m5_theta_summary <- summarize_cm5_results(m5_input,
                                          m5_output,
                                          "theta")

m5_theta_results <- extract_m5_results(m5_input,
                                       m5_output,
                                       par = "theta")
```

```{r m5-polyarchy, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Polyarchy Survey Items", fig.height=3, fig.pos='h', cache=FALSE}
validation_plot(v_vars_poly, lab_x = .9, lab_y = 15,
                m5_theta_summary, m5_theta_results) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 9),
        strip.text.x = element_text(size=5),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support Measured by Model 5",
       y = "% Agreeing")
```

Figure\nobreakspace{}\@ref(fig:m5-polyarchy) shows that, when estimated in this smaller dataset with Claassen's [-@Claassen2019] Model 5, the unidimensional latent variable of democratic support exhibits moderate correlations in the expected direction with two of the validation items: the CDCEE's question on associating democracy with a multi-party system (third panel from the left in the top row) and the AmericasBarometer question on agreement that women should be as involved in politics as men (second panel from the left on the bottom row).
In both cases, the number of country-years observed is less than 25, which cautions against placing very much weight on these two comparisons.
Still, even in light of these two moderate relationships, the overall picture remains the same as that presented in the text: the unidimensional latent variable does not capture much of the public's attitudes toward contestation or participation.

```{r m5-liberties, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Civil Liberties Survey Items", fig.height=4, fig.pos='h'}
validation_plot(v_vars_lib, lab_x = -1,
                theta_summary = m5_theta_summary,
                theta_results = m5_theta_results) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=7),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support Measured by Model 5",
       y = "% Agreeing")
```

```{r m5-institutions, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Democratic Institutions Survey Items", fig.height=3, fig.pos='h'}
validation_plot(v_vars_inst,
                lab_x = -1,
                theta_summary = m5_theta_summary,
                theta_results = m5_theta_results) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=7),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support Measured by Model 5",
       y = "% Agreeing")
```

Figure\nobreakspace{}\@ref(fig:m5-liberties) turns to the validation questions on the civil liberties of freedom of speech, freedom of assembly, and freedom of association.
Here, the only moderate and strong correlations are actually in the opposite of the expected direction: greater support for democracy is associated with a stronger approval to ban protests and to use the military to repress strikes.
Again, however, these relationships are found only where data are particularly scant.
There are only thirteen country-years for which we have these validation questions from the CDCEE and the latent variable of democratic support when estimated as in prior research.
The other relationships with responses to the civil liberties validation items, while mostly in the expected direction, are only weak.

In Figure\nobreakspace{}\@ref(fig:m5-institutions), just two of the eight survey questions asking about institutions that constrain the power of the executive exhibit even moderate correlations with the unidimensional latent variable used in previous research.
Support for the rule of law relates appreciably to this measure of democratic support in only the Afrobarometer; in the Asian Barometer, Latinobarómetro, and Pew Global Attitudes surveys, the correlations are very weak.
Democratic support so measured is similarly weakly related to data from questions tapping support for the legislative branch in the Afrobarometer, AmericasBarometer, and Asian Barometer, with only the Latinobarómetro question on whether national legislatures are necessary at all for democracy showing even a moderate relationship.

```{r m5-conditions, cache = FALSE, fig.cap="Correlations Between Democratic Support as a Unidimensional Latent Variable and Conditionality Survey Items \\label{m5conditions}", fig.height=3, fig.pos='H'}
validation_plot(v_vars_cond,
                lab_x = -1, lab_y = 10,
                theta_summary = m5_theta_summary,
                theta_results = m5_theta_results) +
  theme_bw() +
  theme(legend.position="none",
        axis.text  = element_text(size=8),
        axis.title = element_text(size=9),
        plot.title = element_text(hjust = 0.5, size = 11),
        strip.text.x = element_text(size=7),
        strip.background = element_blank()) +
  labs(x = "Unidimensional Democratic Support Measured by Model 5",
       y = "% Agreeing")
```

The relationships between the more limited unidimensional latent variable of democratic support employed here in this Appendix and the survey questions that ask respondents to choose between order, economic equality, or economic growth, on the one hand, and democracy or political freedom, on the other are shown in Figure\nobreakspace{}\@ref(fig:m5-conditions).
As when the unidimensional latent variable is estimated with more data and the superior DCPO model, these relationships are only very weak.

# References {.unnumbered}

::: {#refs-app}
:::
